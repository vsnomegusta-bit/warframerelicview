<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Warframe Relic - Editor JSON</title>
    <style>
        :root { --gold: #c19b4b; --bg: #0d1117; --card: #161b22; --text: #c9d1d9; --red: #f85149; --green: #238636; --blue: #1f6feb; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; padding: 20px; }
        .container { max-width: 1000px; margin: auto; }
        
        /* Barra de Ferramentas */
        .admin-bar { background: #21262d; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid var(--gold); text-align: center; }
        .admin-bar input { padding: 10px; border-radius: 4px; border: 1px solid #30363d; background: #0d1117; color: white; width: 200px; }
        
        .btn { border: none; padding: 10px 18px; border-radius: 4px; cursor: pointer; font-weight: bold; transition: 0.2s; margin: 5px; }
        .btn-gold { background: var(--gold); color: black; }
        .btn-green { background: var(--green); color: white; }
        .btn-blue { background: var(--blue); color: white; border: 1px solid rgba(255,255,255,0.1); }
        .btn-danger { background: var(--red); color: white; font-size: 0.7em; padding: 4px 8px; }

        .editor-tool { display: none; }
        .unlocked .editor-tool { display: inline-block; }
        .unlocked #login-area { display: none; }

        /* Lista de Itens */
        .relic-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .relic-card { background: var(--card); border-radius: 10px; padding: 15px; border: 1px solid #30363d; }
        .relic-header { border-bottom: 1px solid #333; margin-bottom: 10px; padding-bottom: 5px; display: flex; justify-content: space-between; align-items: center;}
        
        .item-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #21262d; }
        .price-tag { color: #3fb950; font-weight: bold; cursor: pointer; padding: 4px; border-radius: 4px; }
        
        .search-box { display: flex; gap: 10px; margin-bottom: 20px; }
        .search-box input, .search-box select { padding: 12px; border-radius: 6px; border: 1px solid #30363d; background: var(--card); color: white; flex: 1; }
    </style>
</head>
<body>

<div class="container">
    <h1 style="text-align: center; color: var(--gold);">Gerenciador & Exportador JSON</h1>

    <div class="admin-bar">
        <div id="login-area">
            <input type="password" id="passInput" placeholder="Senha do Editor">
            <button class="btn btn-gold" onclick="autenticar()">DESBLOQUEAR EDITOR</button>
        </div>
        <div id="tool-area" class="editor-tool">
            <p style="color: var(--green); margin-bottom: 10px; font-weight: bold;">ðŸ”“ MODO DE EDIÃ‡ÃƒO ATIVO</p>
            <button class="btn btn-green" onclick="addReliquia()">+ RelÃ­quia</button>
            
            <button class="btn btn-blue" onclick="baixarJSON()" title="Baixa o arquivo para hospedar ou backup">ðŸ’¾ SALVAR E GERAR JSON</button>
            
            <button class="btn" style="background:#444; color:white;" onclick="importar()">ðŸ“¥ Importar Dados</button>
        </div>
    </div>

    <div class="search-box">
        <input type="text" id="txtBusca" placeholder="Pesquisar..." onkeyup="filtrar()">
        <select id="selEra" onchange="filtrar()">
            <option value="">Todas as Eras</option>
            <option value="Lith">Lith</option>
            <option value="Meso">Meso</option>
            <option value="Neo">Neo</option>
            <option value="Axi">Axi</option>
        </select>
    </div>

    <div id="listaReliquias" class="relic-grid"></div>
</div>

<script>
    const SENHA_CORRETA = "1234";
    let bancoDados = [
        { era: "Axi", nome: "Exemplo", itens: [{ n: "Parte Prime", p: 10 }] }
    ];

    // Carregar do LocalStorage inicial
    const localData = localStorage.getItem('warframe_db_v3');
    if (localData) bancoDados = JSON.parse(localData);

    function autenticar() {
        if (document.getElementById('passInput').value === SENHA_CORRETA) {
            document.body.classList.add('unlocked');
        } else { alert("Senha Incorreta!"); }
    }

    function renderizar() {
        const grid = document.getElementById('listaReliquias');
        grid.innerHTML = '';

        bancoDados.forEach((reliquia, rIdx) => {
            const card = document.createElement('div');
            card.className = 'relic-card';
            card.setAttribute('data-era', reliquia.era);
            card.setAttribute('data-search', (reliquia.nome + " " + reliquia.itens.map(i => i.n).join(" ")).toLowerCase());

            let html = `
                <div class="relic-header">
                    <div><b>${reliquia.nome}</b> <small>(${reliquia.era})</small></div>
                    <button class="btn-danger editor-tool" onclick="removerReliquia(${rIdx})">Apagar</button>
                </div>`;

            reliquia.itens.forEach((item, iIdx) => {
                html += `
                    <div class="item-row">
                        <span>${item.n}</span>
                        <div>
                            <span class="price-tag" onclick="editarPreco(${rIdx}, ${iIdx})">${item.p} PL</span>
                            <button class="btn-danger editor-tool" onclick="removerItem(${rIdx}, ${iIdx})" style="margin-left:5px">x</button>
                        </div>
                    </div>`;
            });

            html += `<button class="btn btn-green editor-tool" style="width:100%; margin-top:10px; font-size:0.8em" onclick="adicionarItem(${rIdx})">+ Adicionar Item</button>`;
            card.innerHTML = html;
            grid.appendChild(card);
        });
    }

    // FunÃ§Ãµes de EdiÃ§Ã£o
    function addReliquia() {
        const nome = prompt("Nome da RelÃ­quia:");
        const era = prompt("Era (Lith/Meso/Neo/Axi):");
        if (nome && era) {
            bancoDados.push({ era, nome, itens: [] });
            salvarLocal();
        }
    }

    function removerReliquia(idx) {
        if (confirm("Remover esta relÃ­quia?")) {
            bancoDados.splice(idx, 1);
            salvarLocal();
        }
    }

    function adicionarItem(rIdx) {
        const n = prompt("Nome do Item:");
        const p = prompt("PreÃ§o:", "0");
        if (n) {
            bancoDados[rIdx].itens.push({ n, p: parseInt(p) || 0 });
            salvarLocal();
        }
    }

    function removerItem(rIdx, iIdx) {
        bancoDados[rIdx].itens.splice(iIdx, 1);
        salvarLocal();
    }

    function editarPreco(rIdx, iIdx) {
        if (!document.body.classList.contains('unlocked')) return;
        const novo = prompt("Novo preÃ§o:", bancoDados[rIdx].itens[iIdx].p);
        if (novo !== null) {
            bancoDados[rIdx].itens[iIdx].p = parseInt(novo) || 0;
            salvarLocal();
        }
    }

    // SALVAMENTO NO NAVEGADOR (Local)
    function salvarLocal() {
        localStorage.setItem('warframe_db_v3', JSON.stringify(bancoDados));
        renderizar();
    }

    // GERAÃ‡ÃƒO DO ARQUIVO JSON (Para exportar/hospedar)
    function baixarJSON() {
        if (confirm("Isso irÃ¡ gerar o arquivo 'reliquias.json' com todas as suas alteraÃ§Ãµes atuais. Prosseguir?")) {
            const dataStr = JSON.stringify(bancoDados, null, 4);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.href = url;
            link.download = "reliquias.json";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            alert("Arquivo gerado com sucesso! VocÃª pode usÃ¡-lo para atualizar seu cÃ³digo ou mandar para amigos.");
        }
    }

    function importar() {
        const code = prompt("Cole o conteÃºdo do seu arquivo JSON ou cÃ³digo de sync aqui:");
        if (code) {
            try {
                // Tenta ler tanto Base64 quanto JSON puro
                const decoded = code.startsWith('[') ? JSON.parse(code) : JSON.parse(atob(code));
                bancoDados = decoded;
                salvarLocal();
                alert("Dados importados!");
            } catch(e) { alert("Erro ao importar dados. Verifique o formato."); }
        }
    }

    function filtrar() {
        const q = document.getElementById('txtBusca').value.toLowerCase();
        const e = document.getElementById('selEra').value;
        document.querySelectorAll('.relic-card').forEach(c => {
            const matchesSearch = c.getAttribute('data-search').includes(q);
            const matchesEra = e === "" || c.getAttribute('data-era') === e;
            c.style.display = (matchesSearch && matchesEra) ? "block" : "none";
        });
    }

    renderizar();
</script>

</body>
</html>
